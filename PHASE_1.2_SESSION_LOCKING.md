# Phase 1.2: Session Locking & Conflict Prevention

## –û–≥–ª—è–¥ –ø—Ä–æ–±–ª–µ–º–∏

**–ü–æ—Ç–æ—á–Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞:**
–ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–∫—Ä–∏–≤–∞—î –¥–æ–¥–∞—Ç–æ–∫ –Ω–∞ —Å–≤–æ—î–º—É –ü–ö, –ø–æ–∫–∏ –Ω–∞ —ñ–Ω—à–æ–º—É –ü–ö –≤–∂–µ –ø—Ä–∞—Ü—é—î —ñ–Ω—à–∞ –ª—é–¥–∏–Ω–∞ –∑ —Ç–∏–º —Å–∞–º–∏–º –∫–ª—ñ—î–Ω—Ç–æ–º, –¥–æ–¥–∞—Ç–æ–∫ –ø—Ä–æ–ø–æ–Ω—É—î –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É —Å–µ—Å—ñ—é. –¶–µ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ:
- –ö–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ –¥–∞–Ω–∏—Ö –º—ñ–∂ –¥–≤–æ–º–∞ –ü–ö
- –í—Ç—Ä–∞—Ç–∏ –¥–∞–Ω–∏—Ö –ø—Ä–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ–º—É –∑–∞–ø–∏—Å—ñ
- –ü–ª—É—Ç–∞–Ω–∏–Ω–∏ —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

**–†—ñ—à–µ–Ω–Ω—è Phase 1.2:**
–°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Å–µ—Å—ñ–π, —è–∫–∞ –∑–∞–ø–æ–±—ñ–≥–∞—î –æ–¥–Ω–æ—á–∞—Å–Ω–æ–º—É –¥–æ—Å—Ç—É–ø—É –¥–æ –æ–¥–Ω—ñ—î—ó —Å–µ—Å—ñ—ó –∑ —Ä—ñ–∑–Ω–∏—Ö –ü–ö —Ç–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ –ø–æ–∫–∞–∑—É—î —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–∏—Ö —Å–µ—Å—ñ–π.

---

## –¢–µ—Ö–Ω—ñ—á–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### 1. –§–∞–π–ª –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Å–µ—Å—ñ—ó `.session.lock`

**–†–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è:** `{client_dir}/sessions/{session_timestamp}/.session.lock`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON:**
```json
{
  "locked_by": "DESKTOP-ABC123",
  "user_name": "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ",
  "lock_time": "2025-10-28T14:30:45",
  "process_id": 12345,
  "app_version": "1.2.0",
  "heartbeat": "2025-10-28T14:35:12"
}
```

**–ü–æ–ª—è:**
- `locked_by` - –Ü–º'—è –∫–æ–º–ø'—é—Ç–µ—Ä–∞ (socket.gethostname())
- `user_name` - –Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ Windows (os.getlogin())
- `lock_time` - –ö–æ–ª–∏ —Å–µ—Å—ñ—é –±—É–ª–æ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ (ISO 8601)
- `process_id` - PID –ø—Ä–æ—Ü–µ—Å—É Python
- `app_version` - –í–µ—Ä—Å—ñ—è –¥–æ–¥–∞—Ç–∫—É
- `heartbeat` - –û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è heartbeat (–∫–æ–∂–Ω—ñ 30 —Å–µ–∫)

### 2. SessionLockManager –∫–ª–∞—Å

**–§–∞–π–ª:** `src/session_lock_manager.py` (–Ω–æ–≤–∏–π)

**–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ:**
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –±–ª–æ–∫—É–≤–∞–Ω—å
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
- Heartbeat –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∂–∏–≤–æ—Å—Ç—ñ
- Crash recovery –¥–ª—è –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö locks
- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤–ª–∞—Å–Ω–∏–∫–∞ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è

**–ö–ª—é—á–æ–≤—ñ –º–µ—Ç–æ–¥–∏:**

```python
class SessionLockManager:
    def __init__(self, profile_manager):
        """–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –º–µ–Ω–µ–¥–∂–µ—Ä –±–ª–æ–∫—É–≤–∞–Ω—å"""

    def acquire_lock(self, client_id: str, session_dir: Path) -> Tuple[bool, Optional[str]]:
        """
        –°–ø—Ä–æ–±–∞ –∑–∞—Ö–æ–ø–∏—Ç–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Å–µ—Å—ñ—ó.

        Returns:
            (success: bool, error_message: Optional[str])
            - (True, None) —è–∫—â–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ
            - (False, "message") —è–∫—â–æ —Å–µ—Å—ñ—è –≤–∂–µ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞ –∑ –¥–µ—Ç–∞–ª—è–º–∏
        """

    def release_lock(self, session_dir: Path) -> bool:
        """–ó–≤—ñ–ª—å–Ω–∏—Ç–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ —Å–µ—Å—ñ—ó"""

    def is_locked(self, session_dir: Path) -> Tuple[bool, Optional[Dict]]:
        """
        –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞ —Å–µ—Å—ñ—è.

        Returns:
            (is_locked: bool, lock_info: Optional[Dict])
            - (False, None) —è–∫—â–æ –Ω–µ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞
            - (True, {...}) —è–∫—â–æ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞ –∑ —ñ–Ω—Ñ–æ –ø—Ä–æ –≤–ª–∞—Å–Ω–∏–∫–∞
        """

    def update_heartbeat(self, session_dir: Path) -> bool:
        """–û–Ω–æ–≤–∏—Ç–∏ heartbeat –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—ó —Å–µ—Å—ñ—ó (–∫–æ–∂–Ω—ñ 30 —Å–µ–∫)"""

    def is_lock_stale(self, lock_info: Dict, stale_timeout: int = 300) -> bool:
        """
        –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ lock –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π (–º–æ–∂–ª–∏–≤–æ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤–ø–∞–ª–∞).

        Args:
            stale_timeout: –°–µ–∫—É–Ω–¥ –±–µ–∑ heartbeat –ø—ñ—Å–ª—è —è–∫–æ–≥–æ lock –≤–≤–∞–∂–∞—î—Ç—å—Å—è –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–º
                         (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 5 —Ö–≤–∏–ª–∏–Ω)
        """

    def force_release_lock(self, session_dir: Path) -> bool:
        """–ü—Ä–∏–º—É—Å–æ–≤–æ –∑–≤—ñ–ª—å–Ω–∏—Ç–∏ lock (–¥–ª—è recovery –ø—ñ—Å–ª—è crash)"""

    def get_lock_display_info(self, lock_info: Dict) -> str:
        """
        –§–æ—Ä–º–∞—Ç—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ lock –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É.

        Returns:
            "–ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ –Ω–∞ –ü–ö DESKTOP-ABC123\n
             –ß–∞—Å –±–ª–æ–∫—É–≤–∞–Ω–Ω—è: 28.10.2025 14:30"
        """
```

### 3. –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ SessionManager

**–ó–º—ñ–Ω–∏ —É `src/session_manager.py`:**

```python
class SessionManager:
    def __init__(self, client_id: str, profile_manager, lock_manager):
        self.client_id = client_id
        self.profile_manager = profile_manager
        self.lock_manager = lock_manager  # –ù–û–í–ò–ô
        self.heartbeat_timer = None  # –ù–û–í–ò–ô

    def start_session(self, packing_list_path: str, restore_dir: str = None) -> str:
        """–ú–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è–º–∏"""

        if restore_dir:
            # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —Å–µ—Å—ñ—è –Ω–µ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞
            is_locked, lock_info = self.lock_manager.is_locked(Path(restore_dir))

            if is_locked:
                # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —Ü–µ –Ω–∞—à –≤–ª–∞—Å–Ω–∏–π lock
                if lock_info['locked_by'] == socket.gethostname() and \
                   lock_info['process_id'] == os.getpid():
                    # –¶–µ –º–∏ —Å–∞–º—ñ - –ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ
                    pass
                else:
                    # –°–µ—Å—ñ—è –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞ —ñ–Ω—à–∏–º –ü–ö
                    raise SessionLockedError(
                        f"Session is locked by another PC",
                        lock_info=lock_info
                    )

        # –°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–±–æ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ —Å–µ—Å—ñ—é
        self.output_dir = Path(restore_dir) if restore_dir else \
                         self.profile_manager.get_session_dir(self.client_id)

        # –ó–∞—Ö–æ–ø–∏—Ç–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
        success, error_msg = self.lock_manager.acquire_lock(
            self.client_id,
            self.output_dir
        )

        if not success:
            raise SessionLockedError(error_msg)

        # –ó–∞–ø—É—Å—Ç–∏—Ç–∏ heartbeat —Ç–∞–π–º–µ—Ä
        self._start_heartbeat()

        # ... —Ä–µ—à—Ç–∞ –∫–æ–¥—É

    def end_session(self):
        """–ú–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –¥–ª—è –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –±–ª–æ–∫—É–≤–∞–Ω–Ω—è"""
        self._stop_heartbeat()
        self.lock_manager.release_lock(self.output_dir)
        # ... —Ä–µ—à—Ç–∞ –∫–æ–¥—É

    def _start_heartbeat(self):
        """–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è heartbeat"""
        # –û–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥

    def _stop_heartbeat(self):
        """–ó—É–ø–∏–Ω–∏—Ç–∏ heartbeat –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ —Å–µ—Å—ñ—ó"""
```

### 4. –ù–æ–≤—ñ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è

**–§–∞–π–ª:** `src/exceptions.py` (–Ω–æ–≤–∏–π –∞–±–æ –¥–æ–ø–æ–≤–Ω–∏—Ç–∏ —ñ—Å–Ω—É—é—á–∏–π)

```python
class SessionLockedError(Exception):
    """–í–∏–∫–ª—é—á–µ–Ω–Ω—è –∫–æ–ª–∏ —Å–µ—Å—ñ—è –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞ —ñ–Ω—à–∏–º –ø—Ä–æ—Ü–µ—Å–æ–º"""
    def __init__(self, message: str, lock_info: Optional[Dict] = None):
        super().__init__(message)
        self.lock_info = lock_info
```

---

## UI/UX –∑–º—ñ–Ω–∏

### 1. –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–∏—Ö —Å–µ—Å—ñ–π —É —Å–ø–∏—Å–∫—É –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è

**–§–∞–π–ª:** `src/main.py` - –º–µ—Ç–æ–¥ `load_previous_sessions()`

**–ü–æ—Ç–æ—á–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞:**
```
–ù–µ–∑–∞–≤–µ—Ä—à–µ–Ω—ñ —Å–µ—Å—ñ—ó:
  üì¶ Session_2025-10-28_143045
  üì¶ Session_2025-10-27_091523
```

**–ù–æ–≤–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞:**
```
–ù–µ–∑–∞–≤–µ—Ä—à–µ–Ω—ñ —Å–µ—Å—ñ—ó:
  üîí Session_2025-10-28_143045  [–ê–ö–¢–ò–í–ù–ê –Ω–∞ DESKTOP-PC2 - –ú–∞—Ä—ñ—è –Ü–≤–∞–Ω–æ–≤–∞]
  üì¶ Session_2025-10-27_091523
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**
```python
def load_previous_sessions(self):
    """–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö —Å–µ—Å—ñ–π –∑ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—î—é –±–ª–æ–∫—É–≤–∞–Ω—å"""
    sessions = self.profile_manager.get_incomplete_sessions(self.current_client_id)

    for session_dir in sessions:
        # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
        is_locked, lock_info = self.lock_manager.is_locked(session_dir)

        if is_locked:
            # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —Ü–µ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π lock
            if self.lock_manager.is_lock_stale(lock_info):
                icon = "‚ö†Ô∏è"  # –ó–∞—Å—Ç–∞—Ä—ñ–ª–∏–π lock (–º–æ–∂–ª–∏–≤–æ crash)
                status = " [–ó–ê–°–¢–ê–†–Ü–õ–ò–ô LOCK - –º–æ–∂–ª–∏–≤–æ crash]"
                self.session_combo.addItem(
                    f"{icon} {session_dir.name}{status}",
                    userData={"path": session_dir, "locked": True, "stale": True}
                )
            else:
                icon = "üîí"
                pc_name = lock_info.get('locked_by', 'Unknown')
                user_name = lock_info.get('user_name', 'Unknown')
                status = f" [–ê–ö–¢–ò–í–ù–ê –Ω–∞ {pc_name} - {user_name}]"
                self.session_combo.addItem(
                    f"{icon} {session_dir.name}{status}",
                    userData={"path": session_dir, "locked": True, "stale": False}
                )
        else:
            icon = "üì¶"
            self.session_combo.addItem(
                f"{icon} {session_dir.name}",
                userData={"path": session_dir, "locked": False}
            )
```

### 2. –î—ñ–∞–ª–æ–≥ –ø—Ä–∏ —Å–ø—Ä–æ–±—ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—É —Å–µ—Å—ñ—é

**–¢—Ä–∏ —Å—Ü–µ–Ω–∞—Ä—ñ—ó:**

#### –°—Ü–µ–Ω–∞—Ä—ñ–π A: –°–µ—Å—ñ—è –∞–∫—Ç–∏–≤–Ω–∞ –Ω–∞ —ñ–Ω—à–æ–º—É –ü–ö (–Ω–æ—Ä–º–∞–ª—å–Ω–∏–π lock)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚ö†Ô∏è  –°–µ—Å—ñ—è –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                      ‚îÇ
‚îÇ  –¶—è —Å–µ—Å—ñ—è –∑–∞—Ä–∞–∑ –∞–∫—Ç–∏–≤–Ω–∞ –Ω–∞ —ñ–Ω—à–æ–º—É –∫–æ–º–ø'—é—Ç–µ—Ä—ñ:       ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: –ú–∞—Ä—ñ—è –Ü–≤–∞–Ω–æ–≤–∞                        ‚îÇ
‚îÇ  üíª –ö–æ–º–ø'—é—Ç–µ—Ä: DESKTOP-PC2                          ‚îÇ
‚îÇ  üïê –ü–æ—á–∞—Ç–æ–∫ —Ä–æ–±–æ—Ç–∏: 28.10.2025 14:30               ‚îÇ
‚îÇ  ‚úÖ –°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–Ω–∞ (heartbeat 30 —Å–µ–∫ —Ç–æ–º—É)         ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ —Ü—é —Å–µ—Å—ñ—é, –ø–æ–∫–∏ –≤–æ–Ω–∞         ‚îÇ
‚îÇ  –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —ñ–Ω—à–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º.                ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  –ó–∞—á–µ–∫–∞–π—Ç–µ, –ø–æ–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–æ–±–æ—Ç—É,       ‚îÇ
‚îÇ  –∞–±–æ –æ–±–µ—Ä—ñ—Ç—å —ñ–Ω—à—É —Å–µ—Å—ñ—é / —Å—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É.            ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ                           [ OK ]                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–î—ñ—è:** –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è, –ø–æ–∫–∞–∑–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∫–Ω–æ–ø–∫—É OK.

#### –°—Ü–µ–Ω–∞—Ä—ñ–π B: –ó–∞—Å—Ç–∞—Ä—ñ–ª–∏–π lock (–º–æ–∂–ª–∏–≤–æ crash)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚ö†Ô∏è  –ó–∞—Å—Ç–∞—Ä—ñ–ª–∏–π lock                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                      ‚îÇ
‚îÇ  –¶—è —Å–µ—Å—ñ—è –±—É–ª–∞ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞, –∞–ª–µ heartbeat –Ω–µ        ‚îÇ
‚îÇ  –æ–Ω–æ–≤–ª—é–≤–∞–≤—Å—è –±—ñ–ª—å—à–µ 5 —Ö–≤–∏–ª–∏–Ω.                       ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: –Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ                       ‚îÇ
‚îÇ  üíª –ö–æ–º–ø'—é—Ç–µ—Ä: DESKTOP-PC1                         ‚îÇ
‚îÇ  üïê –û—Å—Ç–∞–Ω–Ω—ñ–π heartbeat: 28.10.2025 14:15           ‚îÇ
‚îÇ  ‚ùå –°—Ç–∞—Ç—É—Å: –ù–µ–º–∞—î –∑–≤'—è–∑–∫—É (–º–æ–∂–ª–∏–≤–æ crash)          ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  –ú–æ–∂–ª–∏–≤–æ –ø—Ä–æ–≥—Ä–∞–º–∞ –∞–≤–∞—Ä—ñ–π–Ω–æ –∑–∞–∫—Ä–∏–ª–∞—Å—è –Ω–∞ —Ç–æ–º—É –ü–ö.    ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  –©–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏?                              ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ         [ –ó–≤—ñ–ª—å–Ω–∏—Ç–∏ lock —ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏ ]               ‚îÇ
‚îÇ                  [ –°–∫–∞—Å—É–≤–∞—Ç–∏ ]                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–î—ñ—è:** –î–æ–∑–≤–æ–ª–∏—Ç–∏ force release lock —Ç–∞ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Å–µ—Å—ñ—é.

#### –°—Ü–µ–Ω–∞—Ä—ñ–π C: –°–µ—Å—ñ—è –Ω–µ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞ (–Ω–æ—Ä–º–∞–ª—å–Ω–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è)

**–ù—ñ—á–æ–≥–æ –Ω–µ –ø–æ–∫–∞–∑—É—î–º–æ** - –ø—Ä–æ—Å—Ç–æ –≤—ñ–¥–Ω–æ–≤–ª—é—î–º–æ —è–∫ –∑–∞—Ä–∞–∑.

### 3. –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ—Ç–æ—á–Ω–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—ó —Å–µ—Å—ñ—ó —É –≥–æ–ª–æ–≤–Ω–æ–º—É –≤—ñ–∫–Ω—ñ

**–†–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è:** –£ –≤–µ—Ä—Ö–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –ø—ñ–¥ –≤–∏–±–æ—Ä–æ–º –∫–ª—ñ—î–Ω—Ç–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ö–ª—ñ—î–Ω—Ç: [M - Manufacturer    ‚ñº] [+ –ù–æ–≤–∏–π] ‚îÇ
‚îÇ  üìç –ê–∫—Ç–∏–≤–Ω–∞ —Å–µ—Å—ñ—è: Session_2025-10-28_143045‚îÇ
‚îÇ  üîí –ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ –Ω–∞: DESKTOP-PC1 (–≤–∏)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏ (–¥–µ—Ç–∞–ª—å–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó)

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ù–æ—Ä–º–∞–ª—å–Ω–∏–π —Å—Ç–∞—Ä—Ç –Ω–æ–≤–æ—ó —Å–µ—Å—ñ—ó

**–ö—Ä–æ–∫–∏:**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î –∫–ª—ñ—î–Ω—Ç–∞ M
2. –ù–∞—Ç–∏—Å–∫–∞—î "Start Session"
3. –û–±–∏—Ä–∞—î packing list —Ñ–∞–π–ª
4. `SessionManager.start_session()` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
5. `lock_manager.acquire_lock()` —Å—Ç–≤–æ—Ä—é—î `.session.lock`
6. –°–µ—Å—ñ—è —Å—Ç–∞—Ä—Ç—É—î, heartbeat —Ç–∞–π–º–µ—Ä –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫
7. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—Ä–∞—Ü—é—î...
8. –ù–∞—Ç–∏—Å–∫–∞—î "End Session"
9. `lock_manager.release_lock()` –≤–∏–¥–∞–ª—è—î `.session.lock`
10. –°–µ—Å—ñ—è –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–µ–∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ—ó —Å–µ—Å—ñ—ó

**–ö—Ä–æ–∫–∏:**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î –∫–ª—ñ—î–Ω—Ç–∞ M
2. –ë–∞—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö —Å–µ—Å—ñ–π:
   - `üì¶ Session_2025-10-27_091523`
3. –û–±–∏—Ä–∞—î —Ü—é —Å–µ—Å—ñ—é
4. –ù–∞—Ç–∏—Å–∫–∞—î "Restore Session"
5. `lock_manager.is_locked()` –ø–æ–≤–µ—Ä—Ç–∞—î `(False, None)`
6. `lock_manager.acquire_lock()` —Å—Ç–≤–æ—Ä—é—î `.session.lock`
7. –°–µ—Å—ñ—è –≤—ñ–¥–Ω–æ–≤–ª—é—î—Ç—å—Å—è, heartbeat –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è
8. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—Ä–∞—Ü—é—î...

### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –°–ø—Ä–æ–±–∞ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É —Å–µ—Å—ñ—é (–∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ)

**–ü–ö1 (–ú–∞—Ä—ñ—è):** –ü—Ä–∞—Ü—é—î –∑ Session_2025-10-28_143045

**–ü–ö2 (–Ü–≤–∞–Ω):**
1. –í—ñ–¥–∫—Ä–∏–≤–∞—î –¥–æ–¥–∞—Ç–æ–∫, –æ–±–∏—Ä–∞—î –∫–ª—ñ—î–Ω—Ç–∞ M
2. –ë–∞—á–∏—Ç—å:
   - `üîí Session_2025-10-28_143045 [–ê–ö–¢–ò–í–ù–ê –Ω–∞ DESKTOP-PC1 - –ú–∞—Ä—ñ—è –Ü–≤–∞–Ω–æ–≤–∞]`
   - `üì¶ Session_2025-10-27_091523`
3. –ù–∞–º–∞–≥–∞—î—Ç—å—Å—è –æ–±—Ä–∞—Ç–∏ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—É —Å–µ—Å—ñ—é
4. –ù–∞—Ç–∏—Å–∫–∞—î "Restore Session"
5. `lock_manager.is_locked()` –ø–æ–≤–µ—Ä—Ç–∞—î `(True, {...})`
6. **–î—ñ–∞–ª–æ–≥ "–°–µ—Å—ñ—è –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è"** –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è
7. –Ü–≤–∞–Ω –Ω–∞—Ç–∏—Å–∫–∞—î OK
8. –°–µ—Å—ñ—è –ù–ï –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è
9. –Ü–≤–∞–Ω –æ–±–∏—Ä–∞—î —ñ–Ω—à—É —Å–µ—Å—ñ—é –∞–±–æ —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤—É

### –°—Ü–µ–Ω–∞—Ä—ñ–π 4: Crash recovery (–∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π lock)

**–ü–ö1 (–ú–∞—Ä—ñ—è):** –ü—Ä–æ–≥—Ä–∞–º–∞ –∞–≤–∞—Ä—ñ–π–Ω–æ –∑–∞–∫—Ä–∏–ª–∞—Å—è –æ 14:15, lock –∑–∞–ª–∏—à–∏–≤—Å—è

**–ü–ö2 (–Ü–≤–∞–Ω), –æ 14:25:**
1. –í—ñ–¥–∫—Ä–∏–≤–∞—î –¥–æ–¥–∞—Ç–æ–∫, –æ–±–∏—Ä–∞—î –∫–ª—ñ—î–Ω—Ç–∞ M
2. –ë–∞—á–∏—Ç—å:
   - `‚ö†Ô∏è Session_2025-10-28_143045 [–ó–ê–°–¢–ê–†–Ü–õ–ò–ô LOCK - –º–æ–∂–ª–∏–≤–æ crash]`
3. –û–±–∏—Ä–∞—î —Ü—é —Å–µ—Å—ñ—é
4. –ù–∞—Ç–∏—Å–∫–∞—î "Restore Session"
5. `lock_manager.is_locked()` –ø–æ–≤–µ—Ä—Ç–∞—î `(True, {...})`
6. `lock_manager.is_lock_stale()` –ø–æ–≤–µ—Ä—Ç–∞—î `True` (heartbeat > 5 —Ö–≤ —Ç–æ–º—É)
7. **–î—ñ–∞–ª–æ–≥ "–ó–∞—Å—Ç–∞—Ä—ñ–ª–∏–π lock"** –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –∑ –æ–ø—Ü—ñ—î—é "–ó–≤—ñ–ª—å–Ω–∏—Ç–∏ lock"
8. –Ü–≤–∞–Ω –Ω–∞—Ç–∏—Å–∫–∞—î "–ó–≤—ñ–ª—å–Ω–∏—Ç–∏ lock —ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏"
9. `lock_manager.force_release_lock()` –≤–∏–¥–∞–ª—è—î —Å—Ç–∞—Ä–∏–π lock
10. `lock_manager.acquire_lock()` —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π lock
11. –°–µ—Å—ñ—è –≤—ñ–¥–Ω–æ–≤–ª—é—î—Ç—å—Å—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 5: Graceful shutdown (–ø—Ä–∞–≤–∏–ª—å–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è)

**–ö—Ä–æ–∫–∏:**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—Ä–∞—Ü—é—î –∑ –∞–∫—Ç–∏–≤–Ω–æ—é —Å–µ—Å—ñ—î—é
2. –ù–∞—Ç–∏—Å–∫–∞—î –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä–∏—Ç—Ç—è –≤—ñ–∫–Ω–∞ (X)
3. `closeEvent()` –æ–±—Ä–æ–±–Ω–∏–∫ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
4. `session_manager.end_session()` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
5. Heartbeat —Ç–∞–π–º–µ—Ä –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è
6. `lock_manager.release_lock()` –≤–∏–¥–∞–ª—è—î `.session.lock`
7. –°–µ—Å—ñ—è –∫–æ—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è
8. –î–æ–¥–∞—Ç–æ–∫ –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 6: Ungraceful shutdown (–∞–≤–∞—Ä—ñ–π–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è)

**–ü–ö1 (–æ 14:30):**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—Ä–∞—Ü—é—î –∑ –∞–∫—Ç–∏–≤–Ω–æ—é —Å–µ—Å—ñ—î—é
2. Windows crash / Python crash / Kill process / –í–∏–º–∫–Ω–µ–Ω–Ω—è —Å–≤—ñ—Ç–ª–∞
3. `.session.lock` –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –Ω–∞ –¥–∏—Å–∫—É –∑ `heartbeat: "2025-10-28T14:30:00"`

**–ü–ö1 (–æ 14:40 - –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è):**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–∫—Ä–∏–≤–∞—î –¥–æ–¥–∞—Ç–æ–∫ –∑–Ω–æ–≤—É
2. –û–±–∏—Ä–∞—î –∫–ª—ñ—î–Ω—Ç–∞ M
3. –ë–∞—á–∏—Ç—å:
   - `‚ö†Ô∏è Session_2025-10-28_143045 [–ó–ê–°–¢–ê–†–Ü–õ–ò–ô LOCK - –º–æ–∂–ª–∏–≤–æ crash]`
4. –†–æ–∑—É–º—ñ—î —â–æ —Ü–µ –π–æ–≥–æ –≤–ª–∞—Å–Ω–∞ —Å–µ—Å—ñ—è –ø—ñ—Å–ª—è crash
5. –í—ñ–¥–Ω–æ–≤–ª—é—î —á–µ—Ä–µ–∑ –¥—ñ–∞–ª–æ–≥ "–ó–≤—ñ–ª—å–Ω–∏—Ç–∏ lock"

---

## Heartbeat –º–µ—Ö–∞–Ω—ñ–∑–º

### –©–æ —Ç–∞–∫–µ heartbeat?

**Heartbeat** - —Ü–µ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —á–∞—Å—É –≤ `.session.lock` —Ñ–∞–π–ª—ñ, —è–∫–µ –¥–æ–≤–æ–¥–∏—Ç—å —â–æ –ø—Ä–æ–≥—Ä–∞–º–∞ —â–µ –ø—Ä–∞—Ü—é—î.

### –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

```python
class SessionManager:
    def _start_heartbeat(self):
        """–ó–∞–ø—É—Å—Ç–∏—Ç–∏ heartbeat –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥"""
        from PySide6.QtCore import QTimer

        self.heartbeat_timer = QTimer()
        self.heartbeat_timer.timeout.connect(self._update_heartbeat)
        self.heartbeat_timer.start(30000)  # 30 —Å–µ–∫—É–Ω–¥

    def _update_heartbeat(self):
        """–û–Ω–æ–≤–∏—Ç–∏ heartbeat —É lock —Ñ–∞–π–ª—ñ"""
        try:
            self.lock_manager.update_heartbeat(self.output_dir)
        except Exception as e:
            self.logger.error(f"Failed to update heartbeat: {e}")
            # –ù–µ –ø–∞–¥–∞—Ç–∏, –ø—Ä–æ—Å—Ç–æ –∑–∞–ª–æ–≥—É–≤–∞—Ç–∏

    def _stop_heartbeat(self):
        """–ó—É–ø–∏–Ω–∏—Ç–∏ heartbeat –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ"""
        if self.heartbeat_timer:
            self.heartbeat_timer.stop()
            self.heartbeat_timer = None
```

### –ß–æ–º—É 30 —Å–µ–∫—É–Ω–¥?

- –î–æ—Å–∏—Ç—å —á–∞—Å—Ç–æ —â–æ–± —à–≤–∏–¥–∫–æ –≤–∏—è–≤–∏—Ç–∏ crash (< 5 —Ö–≤–∏–ª–∏–Ω)
- –î–æ—Å–∏—Ç—å —Ä—ñ–¥–∫–æ —â–æ–± –Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –º–µ—Ä–µ–∂—É (30 —Å–µ–∫ = 120 –∑–∞–ø–∏—Ç—ñ–≤/–≥–æ–¥–∏–Ω—É)
- Stale timeout = 5 —Ö–≤–∏–ª–∏–Ω = 10 –ø—Ä–æ–ø—É—â–µ–Ω–∏—Ö heartbeats

### –©–æ —è–∫—â–æ –º–µ—Ä–µ–∂–∞ —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞?

```python
def update_heartbeat(self, session_dir: Path) -> bool:
    """–û–Ω–æ–≤–∏—Ç–∏ heartbeat, –Ω–µ –ø–∞–¥–∞—Ç–∏ –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö –º–µ—Ä–µ–∂—ñ"""
    try:
        lock_path = session_dir / ".session.lock"

        # –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –æ–Ω–æ–≤–∏—Ç–∏
        with open(lock_path, 'r+', encoding='utf-8') as f:
            msvcrt.locking(f.fileno(), msvcrt.LK_NBLCK, 1)
            try:
                data = json.load(f)
                data['heartbeat'] = datetime.now().isoformat()
                f.seek(0)
                f.truncate()
                json.dump(data, f, indent=2)
            finally:
                msvcrt.locking(f.fileno(), msvcrt.LK_UNLCK, 1)
        return True

    except (IOError, OSError) as e:
        # –ú–µ—Ä–µ–∂–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ - –ù–ï –ø–∞–¥–∞—Ç–∏
        self.logger.warning(f"Failed to update heartbeat (network issue?): {e}")
        return False  # –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ —Ü–µ–π heartbeat
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –Ø–∫—â–æ –º–µ—Ä–µ–∂–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ 2-3 —Ö–≤–∏–ª–∏–Ω–∏, heartbeat –ø—Ä–æ—Å—Ç–æ –Ω–µ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è, –∞–ª–µ –ø—Ä–æ–≥—Ä–∞–º–∞ –ø—Ä–æ–¥–æ–≤–∂—É—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏. Lock —Å—Ç–∞–Ω–µ "stale" –ø—ñ—Å–ª—è 5 —Ö–≤–∏–ª–∏–Ω –±–µ–∑ heartbeat.

---

## –§–∞–π–ª–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è)

```
\\192.168.88.101\Z_GreenDelivery\WAREHOUSE\2Packing-tool\
‚îú‚îÄ‚îÄ clients\
‚îÇ   ‚îî‚îÄ‚îÄ M\
‚îÇ       ‚îú‚îÄ‚îÄ client_info.json
‚îÇ       ‚îú‚îÄ‚îÄ sku_mappings.json
‚îÇ       ‚îî‚îÄ‚îÄ sessions\
‚îÇ           ‚îú‚îÄ‚îÄ Session_2025-10-28_143045\
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ .session.lock          # ‚Üê –ù–û–í–ò–ô —Ñ–∞–π–ª
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ session_state.json
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ packing_list.xlsx
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ output.xlsx
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ barcodes\
‚îÇ           ‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îÇ           ‚îî‚îÄ‚îÄ Session_2025-10-27_091523\
‚îÇ               ‚îú‚îÄ‚îÄ .session.lock          # ‚Üê —è–∫—â–æ –∞–∫—Ç–∏–≤–Ω–∞
‚îÇ               ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ logs\
    ‚îî‚îÄ‚îÄ packing_tool_2025-10-28.log
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** `.session.lock` —ñ—Å–Ω—É—î –¢–Ü–õ–¨–ö–ò –∫–æ–ª–∏ —Å–µ—Å—ñ—è –∞–∫—Ç–∏–≤–Ω–∞. –ü—Ä–∏ end_session —Ñ–∞–π–ª –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è.

---

## –õ–æ–≥—É–≤–∞–Ω–Ω—è

### –°–æ–±—ã—Ç–∏—è –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è

```python
# –£—Å–ø—ñ—à–Ω–µ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è lock
logger.info(f"Session lock acquired", extra={
    "client_id": "M",
    "session_dir": "Session_2025-10-28_143045",
    "locked_by": "DESKTOP-PC1",
    "user_name": "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ"
})

# –ó–≤—ñ–ª—å–Ω–µ–Ω–Ω—è lock
logger.info(f"Session lock released", extra={
    "client_id": "M",
    "session_dir": "Session_2025-10-28_143045"
})

# –°–ø—Ä–æ–±–∞ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—É —Å–µ—Å—ñ—é
logger.warning(f"Attempt to open locked session", extra={
    "client_id": "M",
    "session_dir": "Session_2025-10-28_143045",
    "locked_by": "DESKTOP-PC2",
    "attempted_by": "DESKTOP-PC1"
})

# Force release –∑–∞—Å—Ç–∞—Ä—ñ–ª–æ–≥–æ lock
logger.warning(f"Stale lock force-released", extra={
    "session_dir": "Session_2025-10-28_143045",
    "original_lock_by": "DESKTOP-PC2",
    "released_by": "DESKTOP-PC1",
    "stale_for_minutes": 12
})

# Heartbeat update
logger.debug(f"Heartbeat updated", extra={
    "session_dir": "Session_2025-10-28_143045"
})

# Heartbeat failure (–º–µ—Ä–µ–∂–∞)
logger.warning(f"Heartbeat update failed", extra={
    "session_dir": "Session_2025-10-28_143045",
    "error": str(e)
})
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç-–∫–µ–π—Å–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

#### 1. –ë–∞–∑–æ–≤–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
- [ ] –°—Ç–∞—Ä—Ç –Ω–æ–≤–æ—ó —Å–µ—Å—ñ—ó —Å—Ç–≤–æ—Ä—é—î `.session.lock`
- [ ] End session –≤–∏–¥–∞–ª—è—î `.session.lock`
- [ ] –ó–∞–∫—Ä–∏—Ç—Ç—è –≤—ñ–∫–Ω–∞ (X) –≤–∏–¥–∞–ª—è—î `.session.lock`

#### 2. Concurrent –¥–æ—Å—Ç—É–ø
- [ ] –ü–ö1: –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Å–µ—Å—ñ—é –¥–ª—è –∫–ª—ñ—î–Ω—Ç–∞ M
- [ ] –ü–ö2: —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ç—É —Å–∞–º—É —Å–µ—Å—ñ—é
- [ ] –ü–ö2: –º–∞—î –ø–æ–±–∞—á–∏—Ç–∏ üîí —ñ–∫–æ–Ω–∫—É
- [ ] –ü–ö2: –ø—Ä–∏ —Å–ø—Ä–æ–±—ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏ - –¥—ñ–∞–ª–æ–≥ "–≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è"
- [ ] –ü–ö2: –Ω–µ –º–æ–∂–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Å–µ—Å—ñ—é
- [ ] –ü–ö1: –∑–∞–≤–µ—Ä—à–∏—Ç–∏ —Å–µ—Å—ñ—é
- [ ] –ü–ö2: –æ–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ (–∞–±–æ –∞–≤—Ç–æ-–æ–Ω–æ–≤–ª–µ–Ω–Ω—è)
- [ ] –ü–ö2: —Ç–µ–ø–µ—Ä –º–æ–∂–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Å–µ—Å—ñ—é

#### 3. Heartbeat
- [ ] Heartbeat –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫
- [ ] Lock —Ñ–∞–π–ª –º–∞—î –∞–∫—Ç—É–∞–ª—å–Ω–∏–π timestamp –≤ `heartbeat`
- [ ] –ü—ñ—Å–ª—è 5+ —Ö–≤–∏–ª–∏–Ω –±–µ–∑ heartbeat lock —Å—Ç–∞—î "stale"

#### 4. Crash recovery
- [ ] –ü–ö1: –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Å–µ—Å—ñ—é
- [ ] –ü–ö1: Force kill –ø—Ä–æ—Ü–µ—Å—É Python (Task Manager)
- [ ] –ü–ö1: `.session.lock` –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –Ω–∞ –¥–∏—Å–∫—É
- [ ] –ü–ö2: —á–µ—Ä–µ–∑ 5+ —Ö–≤–∏–ª–∏–Ω –ø–æ–±–∞—á–∏—Ç—å ‚ö†Ô∏è —ñ–∫–æ–Ω–∫—É "–ó–ê–°–¢–ê–†–Ü–õ–ò–ô LOCK"
- [ ] –ü–ö2: –º–æ–∂–µ force release lock
- [ ] –ü–ö2: –º–æ–∂–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Å–µ—Å—ñ—é

#### 5. –ú–µ—Ä–µ–∂–µ–≤—ñ –∑–±–æ—ó
- [ ] –°–µ—Å—ñ—è –∞–∫—Ç–∏–≤–Ω–∞, –≤—ñ–¥–∫–ª—é—á–∏—Ç–∏ –º–µ—Ä–µ–∂—É –Ω–∞ 2 —Ö–≤–∏–ª–∏–Ω–∏
- [ ] Heartbeat –ù–ï –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è, –∞–ª–µ –ø—Ä–æ–≥—Ä–∞–º–∞ –ø—Ä–∞—Ü—é—î
- [ ] –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –º–µ—Ä–µ–∂—É –∑–Ω–æ–≤—É
- [ ] Heartbeat –≤—ñ–¥–Ω–æ–≤–ª—é—î—Ç—å—Å—è
- [ ] Lock –Ω–µ —Å—Ç–∞–≤ "stale" (< 5 —Ö–≤–∏–ª–∏–Ω –±–µ–∑ –º–µ—Ä–µ–∂—ñ)

#### 6. –û–¥–Ω–æ—á–∞—Å–Ω–∏–π —Å—Ç–∞—Ä—Ç
- [ ] –ü–ö1 —ñ –ü–ö2: –æ–¥–Ω–æ—á–∞—Å–Ω–æ –æ–±—Ä–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞ M
- [ ] –ü–ö1 —ñ –ü–ö2: –æ–¥–Ω–æ—á–∞—Å–Ω–æ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ "Start Session"
- [ ] –¢—ñ–ª—å–∫–∏ –æ–¥–∏–Ω –ü–ö –º–∞—î —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ lock
- [ ] –î—Ä—É–≥–∏–π –ü–ö –º–∞—î –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É –±–ª–æ–∫—É–≤–∞–Ω–Ω—è

#### 7. UI —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- [ ] üîí —ñ–∫–æ–Ω–∫–∞ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω–∏—Ö —Å–µ—Å—ñ–π
- [ ] ‚ö†Ô∏è —ñ–∫–æ–Ω–∫–∞ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –¥–ª—è –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö locks
- [ ] üì¶ —ñ–∫–æ–Ω–∫–∞ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –¥–ª—è –≤—ñ–ª—å–Ω–∏—Ö —Å–µ—Å—ñ–π
- [ ] –Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –ü–ö –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ
- [ ] –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–∫—Ç–∏–≤–Ω–æ—ó —Å–µ—Å—ñ—ó —É –≥–æ–ª–æ–≤–Ω–æ–º—É –≤—ñ–∫–Ω—ñ

---

## –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑ Phase 1.1

### –ß–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö?

**–ù–Ü** - Phase 1.2 –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–≤–æ—Ä–æ—Ç–Ω—å–æ —Å—É–º—ñ—Å–Ω–∞ –∑ Phase 1.1.

**–ü—Ä–∏—á–∏–Ω–∏:**
- `.session.lock` —Ñ–∞–π–ª - —Ü–µ –ù–û–í–ò–ô —Ñ–∞–π–ª, —Å—Ç–∞—Ä—ñ —Å–µ—Å—ñ—ó –π–æ–≥–æ –Ω–µ –º–∞—é—Ç—å
- –Ø–∫—â–æ `.session.lock` –≤—ñ–¥—Å—É—Ç–Ω—ñ–π = —Å–µ—Å—ñ—è –Ω–µ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞
- –í—Å—ñ —ñ—Å–Ω—É—é—á—ñ —Å–µ—Å—ñ—ó –±—É–¥—É—Ç—å –ø–æ–∫–∞–∑–∞–Ω—ñ —è–∫ üì¶ (–≤—ñ–ª—å–Ω—ñ)
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂—É—Ç—å –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ —Ä–æ–±–æ—Ç—É –±–µ–∑ –∑–º—ñ–Ω

### –©–æ —Å—Ç–∞–Ω–µ—Ç—å—Å—è –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ?

1. –ó—É–ø–∏–Ω–∏—Ç–∏ –≤—Å—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –Ω–∞ –≤—Å—ñ—Ö –ü–ö
2. –û–Ω–æ–≤–∏—Ç–∏ .exe —Ñ–∞–π–ª –Ω–∞ –≤—Å—ñ—Ö –ü–ö (–Ω–æ–≤–∞ –≤–µ—Ä—Å—ñ—è –∑ Phase 1.2)
3. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º—É –∑–Ω–æ–≤—É
4. –í—Å—ñ —Å—Ç–∞—Ä—ñ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω—ñ —Å–µ—Å—ñ—ó –±—É–¥—É—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ñ –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
5. –ù–æ–≤—ñ —Å–µ—Å—ñ—ó –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º—É—Ç—å –±–ª–æ–∫—É–≤–∞–Ω–Ω—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:** –ü–æ–ø–µ—Ä–µ–¥–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑–∞–≤–µ—Ä—à–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ —Å–µ—Å—ñ—ó –ø–µ—Ä–µ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º.

---

## –û–±–º–µ–∂–µ–Ω–Ω—è —Ç–∞ –∫–æ–º–ø—Ä–æ–º—ñ—Å–∏

### 1. –ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ –º–µ—Ä–µ–∂—ñ –¥–ª—è heartbeat

**–ü—Ä–æ–±–ª–µ–º–∞:** –Ø–∫—â–æ –º–µ—Ä–µ–∂–∞ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–∞, heartbeat –º–æ–∂–µ –Ω–µ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏—Å—å.

**–†—ñ—à–µ–Ω–Ω—è:**
- Stale timeout = 5 —Ö–≤–∏–ª–∏–Ω (–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ—á–∞—Å–Ω–∏—Ö –∑–±–æ—ó–≤)
- –ü—Ä–æ–≥—Ä–∞–º–∞ –ù–ï –ø–∞–¥–∞—î –ø—Ä–∏ –Ω–µ–≤–¥–∞–ª–æ–º—É heartbeat
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### 2. –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å force release —á—É–∂–∏—Ö locks

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–ö2 –º–æ–∂–µ force release lock –≤—ñ–¥ –ü–ö1, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –ü–ö1 —â–µ –ø—Ä–∞—Ü—é—î (—è–∫—â–æ heartbeat –∑–∞—Å—Ç–∞—Ä—ñ–≤).

**–†—ñ—à–µ–Ω–Ω—è:**
- –î—ñ–∞–ª–æ–≥ –ø–æ–ø–µ—Ä–µ–¥–∂–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –õ–æ–≥—É–≤–∞–Ω–Ω—è force release –¥–ª—è –∞—É–¥–∏—Ç—É
- Stale timeout –¥–æ—Å–∏—Ç—å –≤–µ–ª–∏–∫–∏–π (5 —Ö–≤–∏–ª–∏–Ω) —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ false positives

### 3. Race condition –ø—Ä–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ–º—É —Å—Ç–∞—Ä—Ç—ñ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–ö1 —ñ –ü–ö2 –æ–¥–Ω–æ—á–∞—Å–Ω–æ –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è —Å—Ç–≤–æ—Ä–∏—Ç–∏ lock.

**–†—ñ—à–µ–Ω–Ω—è:**
- –§–∞–π–ª–æ–≤–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è Windows (`msvcrt.locking()`) –≥–∞—Ä–∞–Ω—Ç—É—î –∞—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å
- –û–¥–∏–Ω –ü–ö —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç—å lock, –¥—Ä—É–≥–∏–π –æ—Ç—Ä–∏–º–∞—î –ø–æ–º–∏–ª–∫—É
- Retry logic –∑ exponential backoff

---

## –í–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è

**–í–µ—Ä—Å—ñ—è:** 1.2.0

**Changelog:**
```
v1.2.0 (2025-10-28)
- Added session locking mechanism to prevent concurrent access
- Added heartbeat system to detect crashed sessions
- Added UI indicators for locked/active sessions
- Added dialogs for handling lock conflicts
- Added crash recovery with force lock release option
- Improved session restoration logic
```

---

## –ü–∏—Ç–∞–Ω–Ω—è –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–Ω—è

–ü–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó, –ø—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å:

1. **Stale timeout = 5 —Ö–≤–∏–ª–∏–Ω** - —Ü–µ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ? –ê–±–æ –∑—Ä–æ–±–∏—Ç–∏ –±—ñ–ª—å—à–µ/–º–µ–Ω—à–µ?
2. **Heartbeat —ñ–Ω—Ç–µ—Ä–≤–∞–ª = 30 —Å–µ–∫—É–Ω–¥** - —Ü–µ OK?
3. **Force release** - —á–∏ –¥–æ–∑–≤–æ–ª—è—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –≤—Ä—É—á–Ω—É –∑–≤—ñ–ª—å–Ω—è—Ç–∏ —á—É–∂—ñ locks, —á–∏ —Ç—ñ–ª—å–∫–∏ stale locks?
4. **Auto-refresh —Å–ø–∏—Å–∫—É —Å–µ—Å—ñ–π** - —á–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–æ–∂–Ω—ñ 30 —Å–µ–∫, —â–æ–± –±–∞—á–∏—Ç–∏ –∫–æ–ª–∏ —ñ–Ω—à–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–≤—ñ–ª—å–Ω–∏–≤ —Å–µ—Å—ñ—é?

–Ø–∫—â–æ –≤—Å–µ OK - –ø–æ—á–Ω–µ–º–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é! üöÄ
